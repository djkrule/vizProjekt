<!-- Code from d3-graph-gallery.com -->
<!DOCTYPE html>
<meta charset="utf-8">

<!-- Load d3.js -->
<script src="https://d3js.org/d3.v4.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<!-- Create a div where the graph will take place -->

<body>
  <div id="my_dataviz" style="width: 1450px; height: 800px; display: inline-block;">
    <script>
      // set the dimensions and margins of the graph
      var margin = { top: 20, right: 10, bottom: 10, left: 10 },
        width = 1450 - margin.left - margin.right,
        height = 800 - margin.top - margin.bottom;

      // append the svg object to the body of the page
      var svg = d3.select("#my_dataviz")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");

      // read json data
      d3.json("euroPopulation.json", function (data) {
        // Give the data to this cluster layout:
        var root = d3.hierarchy(data).sum(function (d) { return d.value }) // Here the size of each leave is given in the 'value' field in input data

        // Then d3.treemap computes the position of each element of the hierarchy
        d3.treemap()
          .size([width, height])
          .paddingTop(30)
          .paddingRight(5)
          (root);

        //Colors
        var color = d3.scaleOrdinal()
          .domain(["north", "east", "south", "west"])
          .range(["#016FB9", "#D91414", "#E57A08", "#198A46"]);

        //Opacity
        var opacity1 = d3.scaleLinear()
          .domain([0, 60])
          .range([.3, .9]);
        var opacity2 = d3.scaleLinear()
          .domain([0, 130])
          .range([.3, .9]);
        var opacity3 = d3.scaleLinear()
          .domain([0, 220])
          .range([.3, 1]);
        var opacity4 = d3.scaleLinear()
          .domain([0, 400])
          .range([.3, 1]);
        // use this information to add rectangles:
        svg
          .selectAll("rect")
          .data(root.leaves())
          .enter()
          .append("rect")
          .attr('x', function (d) { return d.x0; })
          .attr('y', function (d) { return d.y0; })
          .attr('width', function (d) { return d.x1 - d.x0; })
          .attr('height', function (d) { return d.y1 - d.y0; })
          .style("stroke", "black")
          .style("fill", function (d) { return color(d.parent.data.name) })
          .style("opacity", function (d) {
            if (d.parent.data.name == "Northern Europe") {
              return opacity1(d.data.value);
            }
            if (d.parent.data.name == "Eastern Europe") {
              return opacity2(d.data.value);
            }
            if (d.parent.data.name == "Southern Europe") {
              return opacity3(d.data.value);
            }
            if (d.parent.data.name == "Western Europe") {
              return opacity4(d.data.value);
            }
          })
          .on("click", function (d) {
            console.log(d.data["fullName"]);
            update("var2")
          })
          .on("mouseover", function (d) {
            d3.select(this)
              .style("opacity", 1)
          })
          .on("mouseout", function (d) {
            d3.select(this).style("fill", function (d) { return color(d.parent.data.name) })
              .style("opacity", function (d) {
                if (d.parent.data.name == "Northern Europe") {
                  return opacity1(d.data.value);
                }
                if (d.parent.data.name == "Eastern Europe") {
                  return opacity2(d.data.value);
                }
                if (d.parent.data.name == "Southern Europe") {
                  return opacity3(d.data.value);
                }
                if (d.parent.data.name == "Western Europe") {
                  return opacity4(d.data.value);
                }
              });
          });

        // title for short names -> ISO-3
        svg
          .selectAll("text")
          .data(root.leaves())
          .enter()
          .append("text")
          .attr("x", function (d) { return d.x0 + 5 })
          .attr("y", function (d) { return d.y0 + 20 })
          .text(function (d) { return d.data.name })
          .attr("font-size", "15px")
          .attr("fill", "white");

        // country-value -> population-density
        svg
          .selectAll("vals")
          .data(root.leaves())
          .enter()
          .append("text")
          .attr("x", function (d) { return d.x0 + 5 })
          .attr("y", function (d) { return d.y0 + 35 })
          .text(function (d) { return d.data.value })
          .attr("font-size", "11px")
          .attr("fill", "white");

        // europe titles - North,east...
        svg
          .selectAll("titles")
          .data(root.descendants().filter(function (d) { return d.depth == 1 }))
          .enter()
          .append("text")
          .attr("x", function (d) { return d.x0 })
          .attr("y", function (d) { return d.y0 + 22 })
          .text(function (d) { return d.data.name })
          .attr("font-size", "25px")
          .attr("fill", function (d) { return color(d.data.name) });
      });
    </script>
  </div>
  <div id="my_dataviz2" style="width: 460px; height:800px;display: inline-block;">
    <script>

      // set the dimensions and margins of the graph
      var margin1 = { top: 200, right: 0, bottom: 100, left: 0 },
        width1 = 400 - margin1.left - margin1.right,
        height1 = 800 - margin1.top - margin1.bottom;

      // append the svg object to the body of the page
      var svg1 = d3.select("#my_dataviz2")
        .append("svg")
        .attr("width", width1 + margin1.left + margin1.right)
        .attr("height", height1 + margin1.top + margin1.bottom)
        .append("g")
        .attr("transform",
          "translate(" + margin1.left + "," + margin1.top + ")");

      // Initialize the X axis
      var x = d3.scaleBand()
        .range([0, width1])
        .padding(0.2);
      var xAxis = svg1.append("g")
        .attr("transform", "translate(0," + height1 + ")")

      // Initialize the Y axis
      var y = d3.scaleLinear()
        .range([height1, 0]);
      var yAxis = svg1.append("g")
        .attr("class", "myYaxis")


      // A function that create / update the plot for a given variable:
      function update(selectedVar) {

        // Parse the Data
        d3.csv("country.txt", function (data) {

          // X axis
          x.domain(data.map(function (d) { return d.group; }))
          xAxis.transition().duration(1000).call(d3.axisBottom(x))

          // Add Y axis
          y.domain([0, d3.max(data, function (d) { return +d[selectedVar] })]);
          yAxis.transition().duration(1000).call(d3.axisLeft(y));

          // variable u: map data to existing bars
          var u = svg1.selectAll("rect")
            .data(data)

          // update bars
          u
            .enter()
            .append("rect")
            .merge(u)
            .transition()
            .duration(1000)
            .attr("x", function (d) { return x(d.group); })
            .attr("y", function (d) { return y(d[selectedVar]); })
            .attr("width", x.bandwidth())
            .attr("height", function (d) { return height1 - y(d[selectedVar]); })
            .attr("fill", "#aaaaaa")
        })
      }

      // Initialize plot
      update('var1')

    </script>
  </div>
</body>